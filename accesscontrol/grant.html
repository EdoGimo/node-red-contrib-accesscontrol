<script type="text/javascript">
    RED.nodes.registerType('grant',{
        category: 'access control',
        color: '#ca9758',
        defaults: {
            name: {value:""},
            who: {value:"", validate: RED.validators.typedInput("whoType")},
            whoType: { value:"str"},

            createAny: {value:false},
            createOwn: {value:false},
            create: {value:"", validate: RED.validators.typedInput("createType")},
            createType: { value:"str"},

            readAny: {value:false},
            readOwn: {value:false},
            read: {value:"", validate: RED.validators.typedInput("readType")},
            readType: { value:"str"},

            updateAny: {value:false},
            updateOwn: {value:false},
            update: {value:"", validate: RED.validators.typedInput("updateType")},
            updateType: { value:"str"},

            deleteAny: {value:false},
            deleteOwn: {value:false},
            delete: {value:"", validate: RED.validators.typedInput("deleteType")},
            deleteType: { value:"str"},

            what: {value:"", validate: RED.validators.typedInput("whatType")},
            whatType: { value:"str"}
        },
        inputs:1,
        outputs:1,
        icon: "font-awesome/fa-shield",
        label: function() {
            return this.name||"grant";
        },
        oneditprepare: function() {
            $("#node-input-who").typedInput({
                default: this.whoType || "str",
                types:["str", "msg"],
                typeField: $("#node-input-whoType")
            });
            
            $("#node-input-what").typedInput({
                default: this.whatType || "str",
                types:["str", "msg"],
                typeField: $("#node-input-whatType")
            });

            $("#node-input-create").typedInput({
                default: this.createType || "str",
                types:["str", "msg"],
                typeField: $("#node-input-createType")
            });

            $("#node-input-read").typedInput({
                default: this.readType || "str",
                types:["str", "msg"],
                typeField: $("#node-input-readType")
            });

            $("#node-input-update").typedInput({
                default: this.updateType || "str",
                types:["str", "msg"],
                typeField: $("#node-input-updateType")
            });

            $("#node-input-delete").typedInput({
                default: this.deleteType || "str",
                types:["str", "msg"],
                typeField: $("#node-input-deleteType")
            });
        },
        onsave: function(){
            this.whoType = $("#node-input-whoType").val();
            this.whatType = $("#node-input-whatType").val();
            this.createType = $("#node-input-createType").val();
            this.readType = $("#node-input-readType").val();
            this.updateType = $("#node-input-updateType").val();
            this.deleteType = $("#node-input-deleteType").val();
        }
    });
</script>


<script type="text/html" data-template-name="grant">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <p>Check the "Help" tab for more information on the parameters.</p>

    <hr>

    <div class="form-row">
        <label for="node-input-who"><i class="fa fa-user-circle"></i> Who</label>
        <input type="text" id="node-input-who" placeholder="Role">
        <input type="hidden" id="node-input-whoType">
    </div>

    <hr>

    <!--CREATE-->
    <div class="form-row">
        <label for="node-input-createAny">&nbsp;</label>            
        <input type="checkbox" id="node-input-createAny" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-createAny" style="width: auto"><i class="fa fa-plus-square-o" style="transform: scaleX(-1);"></i> CreateAny</label>
    </div>
    <div class="form-row">
        <label for="node-input-createOwn">&nbsp;</label>            
        <input type="checkbox" id="node-input-createOwn" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-createOwn" style="width: auto"><i class="fa fa-plus-square" style="transform: scaleX(-1);"></i> CreateOwn</label>
    </div>
    <div class="form-row">
        <label for="node-input-create"><i class="fa fa-wrench"></i> Create attributes</label>
        <input type="text" id="node-input-create" placeholder="Attribute1, Attribute2">
        <input type="hidden" id="node-input-createType">
    </div>

    <hr>

    <!--READ-->
    <div class="form-row">
        <label for="node-input-readAny">&nbsp;</label>            
        <input type="checkbox" id="node-input-readAny" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-readAny" style="width: auto"><i class="fa fa-bookmark-o" style="transform: scaleX(-1);"></i> ReadAny</label>
    </div>
    <div class="form-row">
        <label for="node-input-readOwn">&nbsp;</label>            
        <input type="checkbox" id="node-input-readOwn" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-readOwn" style="width: auto"><i class="fa fa-bookmark" style="transform: scaleX(-1);"></i> ReadOwn</label>
    </div>
    <div class="form-row">
        <label for="node-input-read"><i class="fa fa-wrench"></i> Read attributes</label>
        <input type="text" id="node-input-read" placeholder="Attribute1, Attribute2">
        <input type="hidden" id="node-input-readType">
    </div>

    <hr>

    <!--UPDATE-->
    <div class="form-row">
        <label for="node-input-updateAny">&nbsp;</label>            
        <input type="checkbox" id="node-input-updateAny" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-updateAny" style="width: auto"><i class="fa fa-pencil-square-o" style="transform: scaleX(-1);"></i> UpdateAny</label>
    </div>
    <div class="form-row">
        <label for="node-input-updateOwn">&nbsp;</label>            
        <input type="checkbox" id="node-input-updateOwn" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-updateOwn" style="width: auto"><i class="fa fa-pencil-square" style="transform: scaleX(-1);"></i> UpdateOwn</label>
    </div>
    <div class="form-row">
        <label for="node-input-update"><i class="fa fa-wrench"></i> Update attributes</label>
        <input type="text" id="node-input-update" placeholder="Attribute1, Attribute2">
        <input type="hidden" id="node-input-updateType">
    </div>

    <hr>

    <!--DELETE-->
    <div class="form-row">
        <label for="node-input-deleteAny">&nbsp;</label>            
        <input type="checkbox" id="node-input-deleteAny" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-deleteAny" style="width: auto"><i class="fa fa-minus-square-o" style="transform: scaleX(-1);"></i> DeleteAny</label>
    </div>
    <div class="form-row">
        <label for="node-input-deleteOwn">&nbsp;</label>            
        <input type="checkbox" id="node-input-deleteOwn" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-deleteOwn" style="width: auto"><i class="fa fa-minus-square" style="transform: scaleX(-1);"></i> DeleteOwn</label>
    </div>
    <div class="form-row">
        <label for="node-input-delete"><i class="fa fa-wrench"></i> Delete attributes</label>
        <input type="text" id="node-input-delete" placeholder="Attribute1, Attribute2">
        <input type="hidden" id="node-input-deleteType">
    </div>

    <hr>

    <div class="form-row">
        <label for="node-input-what"><i class="fa fa-object-group"></i> What</label>
        <input type="text" id="node-input-what" placeholder="Object">
        <input type="hidden" id="node-input-whatType">
    </div>
</script>

<script type="text/html" data-help-name="grant">
    <p>Details on module logic at: <a href="https://www.npmjs.com/package/accesscontrol">npmjs.com/accesscontrol</a>.</p>
    <h4>Grant node</h4>
    <p>This node, receiving a message in input, grants a certain role permission to access an object.</p>
    <p>The attributes that can be set are:</p>
    <ul>
    <li>WHO: the role;</li>
    <li>CRUD any/own: the CRUD (Create, Read, Update, Delete) actions, in both the &#39;any&#39; and &#39;own&#39; scopes;</li>
    <li>CRUD attributes: comma-separated strings that can be given to specify which attributes the corresponding action can edit;</li>
    <li>WHAT: the object to be accessed by the role.</li>
    </ul>
    <p><b>Note:</b> All text fields can also be specified using the msg attributes: to get the content of "msg.role" write only "role" after changing the type. Regarding CRUD attributes, be sure to provide an array, otherwise the node may fail or work in the wrong way.</p>
</script>